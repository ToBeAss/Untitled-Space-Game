<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Game</title>
    <style>
        body {
			margin: 0;
			text-align: center;
			background-color: steelblue;
			font-family: monaco;
			cursor: default;
		}

		canvas {
			position: relative;
			margin-top: 100px;
			border: 2px solid black;
			/*cursor: none;*/
			position: absolute;
			margin-left: -30%;
		}
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
	<canvas id="canvasTest"></canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext('2d');

		const canvasTest = document.getElementById("canvasTest");
		const context = canvasTest.getContext('2d');

        const scale = 1;
		canvas.width = 1080 * scale;
		canvas.height = canvas.width / 1.75;
		canvasTest.width = canvas.width;
		canvasTest.height = canvas.height;
		const fps = 30;
		const gameSpeed = 1000 / fps;

		let starMap = new Image();
		starMap.src = "star map.avif";

        let shipImage = new Image();
		shipImage.src = 'ship.png';

		let backgroundScale = 5000;
        let shipScale = 60;
        let shipWidth = shipScale * scale;
        let shipHeight = shipWidth * 0.978;

		let forward;
		let backward;
		let left;
		let right;
		let boosters;

        let ship = {
            image: shipImage,
            width: shipWidth,
            height: shipHeight,
            xPos: canvas.width/2-shipWidth/2,
            yPos: canvas.height/2-shipHeight/2,
            speed: 0,
            rotation: 0
        }

		let backgroundX = ship.xPos-(backgroundScale/2)
		let backgroundY = ship.yPos-(backgroundScale/2)

        function updateScreen ()
        {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();

			context.clearRect(0, 0, canvas.width, canvas.height);

			//ctx.scale(1, 1); // Scale
			/*ctx.translate(ship.xPos, ship.yPos); // Position
			
			ctx.translate(ship.width/2, ship.height/2); // Rotation point
			ctx.rotate(ship.rotation * Math.PI / 180); // Rotation * 0.9948377
			ctx.translate(-ship.width/2, -ship.height/2); // Reset position*/


			if (left) {ship.rotation += 5;}
			if (right) {ship.rotation -= 5;}

			if (forward)
			{
				if (ship.speed < 10) {ship.speed +=1;}
				if (boosters) {ship.speed = 20;}
				else {ship.speed = 10;}
				backgroundX += ship.speed * Math.sin(ship.rotation * Math.PI / 180);
				backgroundY += ship.speed * Math.cos(ship.rotation * Math.PI / 180);
			}
			if (!forward)
			{
				if (ship.speed > 0) {ship.speed -=1;}
				else {ship.speed = 0;}
				backgroundX += ship.speed * Math.sin(ship.rotation * Math.PI / 180);
				backgroundY += ship.speed * Math.cos(ship.rotation * Math.PI / 180);
			}
			if (backward) 
			{
				ship.speed = 5;
				//backgroundX -= ship.speed //* Math.cos(ship.rotation * Math.PI / 180);
				backgroundY -= ship.speed //* Math.sin(ship.rotation * Math.PI / 180);
			}
			

			//ctx.translate(backgroundX+backgroundScale/2, backgroundY+backgroundScale/2)
			//ctx.translate(ship.xPos+(ship.width/2), ship.yPos+(ship.height/2));
			ctx.translate(canvas.width/2, canvas.height/2)
			ctx.rotate(ship.rotation * Math.PI / 180); // Rotation * 0.9948377
			ctx.translate(-canvas.width/2, -canvas.height/2)
			//ctx.translate(-ship.xPos-(ship.width/2), -ship.yPos-(ship.height/2));
			//ctx.translate(-(backgroundX+backgroundScale/2), -(backgroundY+backgroundScale/2))

			ctx.translate(backgroundX+backgroundScale/2, backgroundY+backgroundScale/2)
			ctx.translate(-(backgroundX+backgroundScale/2), -(backgroundY+backgroundScale/2))

			ctx.drawImage(starMap, backgroundX, backgroundY, backgroundScale, backgroundScale);
			context.drawImage(ship.image, ship.xPos, ship.yPos, ship.width, ship.height);
			
            ctx.restore();
            setTimeout(updateScreen, gameSpeed);
        }
        updateScreen();

        onkeydown = function (event)
		{
			if (event.keyCode == 87) // W
			{
				forward = true;
			}
			if (event.keyCode == 83) // S
			{
				backward = true;
			}
			if (event.keyCode == 65) // A
			{
				left = true;
			}
			if (event.keyCode == 68) // D
			{
				right = true;
			}

			if (event.keyCode == 32) // Space
			{
				boosters = true;
			}
		}
		onkeyup = function (event)
		{
			if (event.keyCode == 87) // W
			{
				forward = false;
			}
			if (event.keyCode == 83) // S
			{
				backward = false;
			}
			if (event.keyCode == 65) // A
			{
				left = false;
			}
			if (event.keyCode == 68) // D
			{
				right = false;
			}

			if (event.keyCode == 32) // Space
			{
				boosters = false;
			}
		}

    </script>
</body>
</html>
