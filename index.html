<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Game</title>
    <style>
        body {
			margin: 0;
			text-align: center;
			background-color: steelblue;
			font-family: monaco;
			cursor: default;
		}

		canvas {
			position: relative;
			margin-top: 100px;
			border: 2px solid black;
			position: absolute;
			margin-left: -30%;
		}
    </style>
</head>
<body>
    <canvas class="canvas" id="background"></canvas>
	<canvas class="canvas" id="playerCamera"></canvas>
    <script>
		const canvasElements = document.getElementsByClassName("canvas"); // An array of HTML Canvas Elements
		const canvas = { // An object of Canvas Contexts (Remember to write by HTML order)
			background: null,
			playerCamera: null 
		}

		const scale = 1; // 1 for intended scale
		const screenSize = 1080; // 1080 by default
		const screenRatio = 1.75; // 1.75 for standard 16:9
		const gameSpeed = 30; // 30 for intended speed
		const fps = 60; // 60 by default
		const updateSpeed = 1000 / fps; // how many milliseconds between each update

		function assignCanvases ()
		{
			let index = 0;
			for (const key in canvas) {
				if (canvas.hasOwnProperty(key)) {
					canvas[key] = canvasElements[index].getContext("2d");
					index++;
					console.log(`canvas.${key}: ${canvas[key]}`);
				}
			}
		}
		function scaleCanvases ()
		{
			for (let i = 0; i < canvasElements.length; i++)
			{
				canvasElements[i].width = screenSize * scale;
				canvasElements[i].height = canvasElements[i].width / screenRatio;
			}
		}
		assignCanvases();
		scaleCanvases();


		let starMap = new Image();
		starMap.src = "images/star map.avif";

        let shipImage = new Image();
		shipImage.src = "images/ship.png";

		let backgroundScale = 5000;
        let shipScale = 60;
        let shipWidth = shipScale * scale;
        let shipHeight = shipWidth * 0.978;

		let forward;
		let backward;
		let left;
		let right;
		let boosters;
		let blasters;

        let ship = { // write a class instead as there is to be added different ships
            image: shipImage,
            width: shipWidth,
            height: shipHeight,
            xPos: canvasElements[0].width/2-shipWidth/2,
            yPos: canvasElements[0].height/2-shipHeight/2,
            speed: 0*gameSpeed/fps,
			maxSpeed: 10*gameSpeed/fps,
			acceleration: 0.25*gameSpeed/fps,
			deceleration: 0.1*gameSpeed/fps,
            rotation: 0,
			rotationSpeed: 0*gameSpeed/fps,
			maxRotationSpeed: 5*gameSpeed/fps,
			rotationAcceleration: 0.5*gameSpeed/fps
        }

		let backgroundX = ship.xPos-(backgroundScale/2)
		let backgroundY = ship.yPos-(backgroundScale/2)

        function updateScreen ()
        {
            canvas.background.clearRect(0, 0, canvasElements[0].width, canvasElements[0].height);
            canvas.background.save();

			canvas.playerCamera.clearRect(0, 0, canvasElements[0].width, canvasElements[0].height);


			// if (Math.round(ship.rotation)%360 == 0) {} // Use to find rotation direction

			if (left && !right) 
			{
				if (ship.rotationSpeed < ship.maxRotationSpeed) {ship.rotationSpeed += ship.rotationAcceleration}
				else {ship.rotationSpeed = ship.maxRotationSpeed;}
				ship.rotation += ship.rotationSpeed; 
			}
			if (right && !left) 
			{
				if (ship.rotationSpeed > -ship.maxRotationSpeed) {ship.rotationSpeed -= ship.rotationAcceleration}
				else {ship.rotationSpeed = -ship.maxRotationSpeed;}
				ship.rotation += ship.rotationSpeed; 
			}
			if (left && right)
			{
				if (ship.rotationSpeed > 0.1) {ship.rotationSpeed -= ship.rotationAcceleration}
				else if (ship.rotationSpeed < -0.1) {ship.rotationSpeed += ship.rotationAcceleration}
				else {ship.rotationSpeed = 0;}
				ship.rotation += ship.rotationSpeed;
			}
			if (!left && !right)
			{
				if (ship.rotationSpeed > 0.1) {ship.rotationSpeed -= ship.rotationAcceleration}
				else if (ship.rotationSpeed < -0.1) {ship.rotationSpeed += ship.rotationAcceleration}
				else {ship.rotationSpeed = 0;}
				ship.rotation += ship.rotationSpeed; 
			}

			if (forward)
			{
				if (boosters) 
				{
					if (ship.speed < ship.maxSpeed*2) {ship.speed += ship.acceleration;}
					else {ship.speed = ship.maxSpeed*2;}
				}
				else
				{
					if (ship.speed > ship.maxSpeed+0.1) {ship.speed -= ship.acceleration;}

					else if (ship.speed < ship.maxSpeed) {ship.speed += ship.acceleration;}
					else {ship.speed = ship.maxSpeed;}
				}
				backgroundX += ship.speed * Math.sin(ship.rotation * Math.PI / 180);
				backgroundY += ship.speed * Math.cos(ship.rotation * Math.PI / 180);
			}
			if (!forward)
			{
				if (ship.speed > ship.maxSpeed+0.1) {ship.speed -= ship.acceleration;}

				else if (ship.speed > 0.1) {ship.speed -= ship.speed*ship.deceleration;} // Deceleration value
				else {ship.speed = 0;}
				backgroundX += ship.speed * Math.sin(ship.rotation * Math.PI / 180);
				backgroundY += ship.speed * Math.cos(ship.rotation * Math.PI / 180);
			}

			/*if (backward) 
			{
				ship.speed = 5;
				backgroundX -= ship.speed * Math.sin(ship.rotation * Math.PI / 180);
				backgroundY -= ship.speed * Math.cos(ship.rotation * Math.PI / 180);
			}*/
			

			//canvas.background.translate(backgroundX+backgroundScale/2, backgroundY+backgroundScale/2)
			//canvas.background.translate(ship.xPos+(ship.width/2), ship.yPos+(ship.height/2));
			canvas.background.translate(canvasElements[0].width/2, canvasElements[0].height/2)
			canvas.background.rotate(ship.rotation * Math.PI / 180); // Rotation * 0.9948377
			canvas.background.translate(-canvasElements[0].width/2, -canvasElements[0].height/2)
			//canvas.background.translate(-ship.xPos-(ship.width/2), -ship.yPos-(ship.height/2));
			//canvas.background.translate(-(backgroundX+backgroundScale/2), -(backgroundY+backgroundScale/2))

			//canvas.background.translate(backgroundX+backgroundScale/2, backgroundY+backgroundScale/2)
			//canvas.background.translate(-(backgroundX+backgroundScale/2), -(backgroundY+backgroundScale/2))

			canvas.background.drawImage(starMap, backgroundX, backgroundY, backgroundScale, backgroundScale);
			canvas.playerCamera.drawImage(ship.image, ship.xPos, ship.yPos, ship.width, ship.height);
			
            canvas.background.restore();
            setTimeout(updateScreen, updateSpeed);
        }
        updateScreen();

    </script>
	<script src="input.js"></script>
</body>
</html>
