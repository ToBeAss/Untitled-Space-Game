<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Game</title>
    <style>
        body {
			margin: 0;
			text-align: center;
			background-color: steelblue;
			font-family: monaco;
			cursor: default;
		}

		canvas {
			position: relative;
			margin-top: 100px;
			border: 2px solid black;
			/*cursor: none;*/
			position: absolute;
			margin-left: -30%;
		}
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
	<canvas id="canvasTest"></canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext('2d');

		const canvasTest = document.getElementById("canvasTest");
		const context = canvasTest.getContext('2d');

        const scale = 1;
		canvas.width = 1080 * scale;
		canvas.height = canvas.width / 1.75;
		canvasTest.width = canvas.width;
		canvasTest.height = canvas.height;
		const fps = 60;
		const updateSpeed = 1000 / fps;
		const gameSpeed = 30;

		let starMap = new Image();
		starMap.src = "star map.avif";

        let shipImage = new Image();
		shipImage.src = 'ship.png';

		let backgroundScale = 5000;
        let shipScale = 60;
        let shipWidth = shipScale * scale;
        let shipHeight = shipWidth * 0.978;

		let forward;
		let backward;
		let left;
		let right;
		let boosters;
		let blasters;

        let ship = {
            image: shipImage,
            width: shipWidth,
            height: shipHeight,
            xPos: canvas.width/2-shipWidth/2,
            yPos: canvas.height/2-shipHeight/2,
            speed: 0*gameSpeed/fps,
			maxSpeed: 10*gameSpeed/fps,
			acceleration: 0.25*gameSpeed/fps,
			deceleration: 0.1*gameSpeed/fps,
            rotation: 0,
			rotationSpeed: 0*gameSpeed/fps,
			maxRotationSpeed: 5*gameSpeed/fps,
			rotationAcceleration: 0.5*gameSpeed/fps
        }

		let backgroundX = ship.xPos-(backgroundScale/2)
		let backgroundY = ship.yPos-(backgroundScale/2)

        function updateScreen ()
        {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();

			context.clearRect(0, 0, canvas.width, canvas.height);


			// if (Math.round(ship.rotation)%360 == 0) {} // Use to find rotation direction

			if (left && !right) 
			{
				if (ship.rotationSpeed < ship.maxRotationSpeed) {ship.rotationSpeed += ship.rotationAcceleration}
				else {ship.rotationSpeed = ship.maxRotationSpeed;}
				ship.rotation += ship.rotationSpeed; 
			}
			if (right && !left) 
			{
				if (ship.rotationSpeed > -ship.maxRotationSpeed) {ship.rotationSpeed -= ship.rotationAcceleration}
				else {ship.rotationSpeed = -ship.maxRotationSpeed;}
				ship.rotation += ship.rotationSpeed; 
			}
			if (left && right)
			{
				if (ship.rotationSpeed > 0.1) {ship.rotationSpeed -= ship.rotationAcceleration}
				else if (ship.rotationSpeed < -0.1) {ship.rotationSpeed += ship.rotationAcceleration}
				else {ship.rotationSpeed = 0;}
				ship.rotation += ship.rotationSpeed;
			}
			if (!left && !right)
			{
				if (ship.rotationSpeed > 0.1) {ship.rotationSpeed -= ship.rotationAcceleration}
				else if (ship.rotationSpeed < -0.1) {ship.rotationSpeed += ship.rotationAcceleration}
				else {ship.rotationSpeed = 0;}
				ship.rotation += ship.rotationSpeed; 
			}

			if (forward)
			{
				if (boosters) 
				{
					if (ship.speed < ship.maxSpeed*2) {ship.speed += ship.acceleration;}
					else {ship.speed = ship.maxSpeed*2;}
				}
				else
				{
					if (ship.speed > ship.maxSpeed+0.1) {ship.speed -= ship.acceleration;}

					else if (ship.speed < ship.maxSpeed) {ship.speed += ship.acceleration;}
					else {ship.speed = ship.maxSpeed;}
				}
				backgroundX += ship.speed * Math.sin(ship.rotation * Math.PI / 180);
				backgroundY += ship.speed * Math.cos(ship.rotation * Math.PI / 180);
			}
			if (!forward)
			{
				if (ship.speed > ship.maxSpeed+0.1) {ship.speed -= ship.acceleration;}

				else if (ship.speed > 0.1) {ship.speed -= ship.speed*ship.deceleration;} // Deceleration value
				else {ship.speed = 0;}
				backgroundX += ship.speed * Math.sin(ship.rotation * Math.PI / 180);
				backgroundY += ship.speed * Math.cos(ship.rotation * Math.PI / 180);
			}

			/*if (backward) 
			{
				ship.speed = 5;
				backgroundX -= ship.speed * Math.sin(ship.rotation * Math.PI / 180);
				backgroundY -= ship.speed * Math.cos(ship.rotation * Math.PI / 180);
			}*/
			

			//ctx.translate(backgroundX+backgroundScale/2, backgroundY+backgroundScale/2)
			//ctx.translate(ship.xPos+(ship.width/2), ship.yPos+(ship.height/2));
			ctx.translate(canvas.width/2, canvas.height/2)
			ctx.rotate(ship.rotation * Math.PI / 180); // Rotation * 0.9948377
			ctx.translate(-canvas.width/2, -canvas.height/2)
			//ctx.translate(-ship.xPos-(ship.width/2), -ship.yPos-(ship.height/2));
			//ctx.translate(-(backgroundX+backgroundScale/2), -(backgroundY+backgroundScale/2))

			//ctx.translate(backgroundX+backgroundScale/2, backgroundY+backgroundScale/2)
			//ctx.translate(-(backgroundX+backgroundScale/2), -(backgroundY+backgroundScale/2))

			ctx.drawImage(starMap, backgroundX, backgroundY, backgroundScale, backgroundScale);
			context.drawImage(ship.image, ship.xPos, ship.yPos, ship.width, ship.height);
			
            ctx.restore();
            setTimeout(updateScreen, updateSpeed);
        }
        updateScreen();

        onkeydown = function (event)
		{
			if (event.keyCode == 87) // W
			{
				forward = true;
			}
			if (event.keyCode == 83) // S
			{
				backward = true;
			}
			if (event.keyCode == 65) // A
			{
				left = true;
			}
			if (event.keyCode == 68) // D
			{
				right = true;
			}

			if (event.keyCode == 16) // Shift
			{
				boosters = true;
			}
			if (event.keyCode == 32) // Space
			{
				blasters = true;
			}
		}
		onkeyup = function (event)
		{
			if (event.keyCode == 87) // W
			{
				forward = false;
			}
			if (event.keyCode == 83) // S
			{
				backward = false;
			}
			if (event.keyCode == 65) // A
			{
				left = false;
			}
			if (event.keyCode == 68) // D
			{
				right = false;
			}

			if (event.keyCode == 16) // Shift
			{
				boosters = false;
			}
			if (event.keyCode == 32) // Space
			{
				blasters = true;
			}
		
		}

    </script>
</body>
</html>
